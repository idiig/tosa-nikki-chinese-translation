#+title: 脚本说明
* =extract_chinese_full.sh=
用于从 [[https://github.com/idiig/tosa-translation][idiig/tosa-translation]] 项目中提取中文相关结构的脚本。
用法如下：
#+begin_src shell
  sh extract_chinese_full.sh <input.json> <output.json>
#+end_src

#+begin_details
#+begin_summary
展开阅读脚本文件
#+end_summary
#+begin_src shell :tangle ./extract_chinese_full.sh
  #!/bin/bash
  # extract_chinese_full.sh - Extract Chinese annotations from Japanese classical literature

  # Check input parameters
  if [ $# -eq 0 ]; then
      echo "Usage: $0 <input_JSON_file> [output_file]"
      echo "Example: $0 tosa_nikki.json output.json"
      exit 1
  fi

  INPUT_FILE="$1"
  OUTPUT_FILE="${2:-extracted_chinese.json}"

  # Check if jq is installed
  if ! command -v jq &> /dev/null; then
      echo "Error: jq command not found, please install jq first"
      exit 1
  fi

  # Check if input file exists
  if [ ! -f "$INPUT_FILE" ]; then
      echo "Error: Input file '$INPUT_FILE' does not exist"
      exit 1
  fi

  # Execute jq extraction with null fallback for missing fields
  jq '[.[] | {
    title: (.title // null),
    author: (.author // null),
    paragraph: [.paragraph[]? | {
      id: (.id // null),
      "koutei-yamagen": (."koutei-yamagen" // null),
      "translation-zh": (."translation-zh" // null),
      "phrase-gloss": (if ."phrase-gloss" then [."phrase-gloss"[] | {
        phrase: (.phrase // null),
        "gloss-zh": (."gloss-zh" // null),
        "gloss-morph-zh": (."gloss-morph-zh" // null),
        words: (if .words then [.words[] | {
          word: (.word // null),
          "gloss-zh": (."gloss-zh" // null),
          "gloss-morph-zh": (."gloss-morph-zh" // null)
        }] else null end)
      }] else null end),
      "glossary-abbreviations": (."glossary-abbreviations" // null),
      "translation-zh-natural": (."translation-zh-natural" // null)
    }]
  }]' "$INPUT_FILE" > "$OUTPUT_FILE"

  echo "Extraction completed, results saved to: $OUTPUT_FILE"
#+end_src
#+end_details
* =extract_chinese_natural.sh=
用于从 [[../tosa-zh.json][tosa-zh.json]] 项目中单独提取中文自然译文的脚本。
用法如下：
#+begin_src shell
  sh extract_chinese_natural.sh <output.json>
  #+end_src

#+begin_details
#+begin_summary
展开阅读脚本文件
#+end_summary
#+begin_src shell :tangle ./extract_chinese_natural.sh
  #!/bin/bash
  # extract_chinese_natural.sh - Extract Chinese natural translations from processed JSON

  # Check input parameters
  if [ $# -eq 0 ]; then
      echo "Usage: $0 <input_JSON_file> [output_file]"
      echo "Example: $0 tosa-zh.json natural_translations.json"
      exit 1
  fi

  INPUT_FILE="$1"
  OUTPUT_FILE="${2:-natural_translations.json}"

  # Check if jq is installed
  if ! command -v jq &> /dev/null; then
      echo "Error: jq command not found, please install jq first"
      exit 1
  fi

  # Check if input file exists
  if [ ! -f "$INPUT_FILE" ]; then
      echo "Error: Input file '$INPUT_FILE' does not exist"
      exit 1
  fi

  # Extract Chinese natural translations with metadata
  jq '[.[] | {
    title: (.title // null),
    author: (.author // null),
    translations: [.paragraph[]? | {
      id: (.id // null),
      original: (."koutei-yamagen" // null),
      literal: (."translation-zh" // null),
      natural: (."translation-zh-natural" // null)
    } | select(.natural != null)]
  }]' "$INPUT_FILE" > "$OUTPUT_FILE"

  echo "Natural translation extraction completed, results saved to: $OUTPUT_FILE"
#+end_src
#+end_details
